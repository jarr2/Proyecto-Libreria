<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Default title{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
     <link rel="preconnect" href="https://fonts.googleapis.com">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Source+Sans+3:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
    <style>
      /* Eliminar flechas en Chrome, Safari, Edge y Opera */
      input[type=number]::-webkit-outer-spin-button,
      input[type=number]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      /* Eliminar flechas en Firefox */
      input[type=number] {
        -moz-appearance: textfield;
      }
      .body{
          font-family: 'Source Sans 3';
      }
    </style>
    {% block CustomCSS %}
    {% endblock %}
</head>

<body style="width: 100%; font-family: 'Source Sans 3'">
    <nav class="navbar navbar-expand-lg " style="background-color: #98ffa1;">
  <div class="container-fluid">
    <a class="navbar-brand " >
          <img src="/static/img/Logo.png" alt="Infinity Comics" width="200" onclick="location.href='/home'" height="70">
    </a>

    <div class='collapse navbar-collapse pe-5' id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0 col col-12 justify-content-end">
          <li class="nav-item invisible">
              <a class="nav-link active fs-5" aria-current="page" onclick="location.href='/home'">Inicio</a>
          </li>
          <li class="nav-item">
              <a class="nav-link active fs-5 fw-bold"  href="#" aria-current="page">
                  Favoritos
                 <svg style="fill: #146c43" xmlns="http://www.w3.org/2000/svg" height="32" width="32" viewBox="0 0 576 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg>
              </a>
          </li>
          <li class="nav-item">
              <a class="nav-link active fs-5 fw-bold" role="button" href="#carrito" data-bs-toggle="offcanvas" aria-controls="carrito">
                  Mi carrito
                  <svg style="fill: #146c43" xmlns="http://www.w3.org/2000/svg" height="32" width="32" viewBox="0 0 576 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M0 24C0 10.7 10.7 0 24 0L69.5 0c22 0 41.5 12.8 50.6 32l411 0c26.3 0 45.5 25 38.6 50.4l-41 152.3c-8.5 31.4-37 53.3-69.5 53.3l-288.5 0 5.4 28.5c2.2 11.3 12.1 19.5 23.6 19.5L488 336c13.3 0 24 10.7 24 24s-10.7 24-24 24l-288.3 0c-34.6 0-64.3-24.6-70.7-58.5L77.4 54.5c-.7-3.8-4-6.5-7.9-6.5L24 48C10.7 48 0 37.3 0 24zM128 464a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zm336-48a48 48 0 1 1 0 96 48 48 0 1 1 0-96z"/></svg>
              </a>
          </li>
          <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle fs-5 fw-bold" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <svg style="fill: #146c43" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="32" height="32"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M399 384.2C376.9 345.8 335.4 320 288 320l-64 0c-47.4 0-88.9 25.8-111 64.2c35.2 39.2 86.2 63.8 143 63.8s107.8-24.7 143-63.8zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm256 16a72 72 0 1 0 0-144 72 72 0 1 0 0 144z"/></svg>
                  {{ current_user.usuario.nombre }}
              </a>
              <ul class="dropdown-menu dropdown-menu-end ">
                <li><a class="dropdown-item fs-5" onclick="location.href='/mi-perfil'">Mi perfil</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item fs-5" onclick="location.href='/logout'">Cerrar Sesión</a></li>
              </ul>
          </li>
        </ul>
    </div>
  </div>
</nav>
    {% block page_content %}
        <div class="container-fluid " >
        </div>
        <div class="mt-3">
        </div>
    {% endblock %}
    <div class="offcanvas offcanvas-end" tabindex="-1" id="carrito" aria-labelledby="offcanvasRightLabel">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title fw-bold" id="offcanvasRightLabel">Mi carrito</h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body" >
                <div class="row-cols-1" id="carrito_cont">

                </div>

            </div>
            <p id="respuesta"></p>
        </div>
    {% block customJS %}
        <script src="{{ url_for('static', filename='js/starrr.js')}}"></script>
    {% endblock %}
    <script src="{{ url_for('static', filename='js/animaciones.js')}}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        actualizarCarrito()
});
    function  actualizarCarrito() {
        // Hacer una solicitud GET a la ruta de Flask para obtener datos de la sesión
        fetch('/get_carrito')
            .then(response => response.json())
            .then(data => {
                // Mostrar los datos de la sesión en el HTML
                let carritoDiv = document.getElementById('carrito_cont');
                if (Object.keys(data).length === 0) {
                    carritoDiv.innerHTML = "<p>El carrito está vacío</p>";
                } else {
                    cont = 0
                    cont_par = 0;
                    cont_impar = 1;
                    let lista = "<ul>";
                    carritoDiv.innerHTML = ""
                    for (let item of data) {
                        console.log(cont_impar + " - " + cont_par)
                        console.log(data)
                        var htmlContent = `
                            <div class="card mb-3" style="max-width: 540px;" id="${cont}">
                              <div class="row g-0">
                                <div class="col-md-4">
                                  <img src="../${item[1][7]}" class="img-fluid rounded-start" alt="...">
                                </div>
                                <div class="col-md-8">
                                  <div class="card-body">
                                    <h5 class="card-title">${item[1][1]}</h5>
                                    <p class="card-text">Precio: $${item[1][6]}</p>
                                    <label class="label">Cantidad
                                    <input type="number" class="form-control" value="${item[0]}">
                                    <a href="/remove_carrito?id_cont=${cont}" class="btn btn-danger fs-6 mi-enlace">Eliminar</a>
                                  </div>
                                </div>
                              </div>
                            </div>
                        `;
                        cont = cont + 1
                        cont_par = cont_par + 2;
                        cont_impar = cont_impar + 2;
                        carritoDiv.innerHTML += htmlContent;
                    }
                    var boton_env = `<div>
                            <button class="btn btn-success" onclick="location.href='/enviar_correo'" >Comprar</button>
                        </div>`;
                    carritoDiv.innerHTML += boton_env

                }
            })
            .catch(error => {
                console.error('Error al obtener datos de la sesión:', error);
            });
    }


            document.addEventListener('click', function(event) {
                if (event.target.classList.contains('mi-enlace')) {
                    event.preventDefault(); // Evitar comportamiento predeterminado
                    const href = event.target.getAttribute('href'); // Obtener el ID del enlace
                    /*console.log(`ID del enlace: ${idEnlace}`);*/

                    // Realizar la solicitud GET utilizando el href del enlace
                    fetch(href)
                        .then(response => response.json()) // Parsear la respuesta JSON
                        .then(data => {
                            actualizarCarrito()
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
            }
        });
    </script>
</body>
<footer>
    <div class="mt-2 bg-success text-light font-weight-bold text-center">
        <div class="container">
            <p>© 2024 Urbano Villanueva. All rights reserved.</p>
            
        </div>
    </div>
</footer>
</html>